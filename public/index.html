<!DOCTYPE html>
<html>
  <head>
    <title>Billiard Table Setup</title>
    <style>
      #videoContainer {
        position: relative;
      }
      #videoFeed {
        max-width: 100%;
      }
      .corner {
        position: absolute;
        width: 10px;
        height: 10px;
        background-color: red;
        cursor: move;
      }
    </style>
  </head>
  <body>
    <div id="videoContainer">
      <img id="videoFeed" src="{{ url_for('video_feed') }}" />
      <div id="corner1" class="corner"></div>
      <div id="corner2" class="corner"></div>
      <div id="corner3" class="corner"></div>
      <div id="corner4" class="corner"></div>
    </div>
    <button id="setCorners">Set Corners</button>

    <script>
      const corners = document.querySelectorAll(".corner");
      const setButton = document.getElementById("setCorners");

      corners.forEach((corner) => {
        corner.addEventListener("mousedown", startDragging);
      });

      function startDragging(e) {
        const corner = e.target;
        document.addEventListener("mousemove", drag);
        document.addEventListener("mouseup", stopDragging);

        function drag(e) {
          const container = document.getElementById("videoContainer");
          const rect = container.getBoundingClientRect();
          corner.style.left = `${e.clientX - rect.left}px`;
          corner.style.top = `${e.clientY - rect.top}px`;
        }

        function stopDragging() {
          document.removeEventListener("mousemove", drag);
          document.removeEventListener("mouseup", stopDragging);
        }
      }

      setButton.addEventListener("click", () => {
        const cornerPositions = Array.from(corners).map((corner) => {
          const rect = corner.getBoundingClientRect();
          const container = document.getElementById("videoContainer");
          const containerRect = container.getBoundingClientRect();
          return {
            x: rect.left - containerRect.left,
            y: rect.top - containerRect.top,
          };
        });

        fetch("/set_corners", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ corners: cornerPositions }),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              alert("Corners set successfully!");
            }
          });
      });
    </script>
  </body>
</html>
